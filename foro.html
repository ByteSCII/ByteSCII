<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Foro de Byte – Registro / Login</title>

  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Configuración personalizada de Tailwind (idéntica a index.html)
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            heading: ['Montserrat', 'sans-serif'],
            navigation: ['Montserrat', 'sans-serif'],
          },
          colors: {
            'byte-dark-bg': '#0A0A1A',
            'byte-accent-cyan': '#00FFFF',
            'byte-text-light': '#F9FAFB',
            'byte-secondary-dark': '#1A202C',
          }
        }
      }
    }
  </script>
  <!-- Firebase App (modular) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      sendEmailVerification,
      signInWithEmailAndPassword,
      onAuthStateChanged,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // Tu configuración de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCYpAKjzz-rUBlZYkaEPiZMawfAM8-nQ3Y",
      authDomain: "byteweb-13a12.firebaseapp.com",
      projectId: "byteweb-13a12",
      storageBucket: "byteweb-13a12.firebasestorage.app",
      messagingSenderId: "827941655623",
      appId: "1:827941655623:web:887b7a5220fd416eeccd62"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Elementos
    const registerForm = document.getElementById('register-form');
    const loginForm = document.getElementById('login-form');
    const toggleToLogin = document.getElementById('toggle-to-login');
    const toggleToRegister = document.getElementById('toggle-to-register');

    // Cambio de vista entre registro y login
    toggleToLogin.addEventListener('click', () => {
      document.getElementById('register-container').classList.add('hidden');
      document.getElementById('login-container').classList.remove('hidden');
    });

    toggleToRegister.addEventListener('click', () => {
      document.getElementById('login-container').classList.add('hidden');
      document.getElementById('register-container').classList.remove('hidden');
    });

    // Medidor de contraseña
    const passwordInput = document.getElementById('register-password');
    const passwordStrengthText = document.getElementById('password-strength-text');
    passwordInput.addEventListener('input', () => {
      const val = passwordInput.value;
      let strength = 0;
      if (val.length >= 8) strength++;
      if (/[A-Z]/.test(val)) strength++;
      if (/[0-9]/.test(val)) strength++;
      if (/[^A-Za-z0-9]/.test(val)) strength++;
      if (strength <= 1) {
        passwordStrengthText.textContent = 'Débil';
        passwordStrengthText.className = 'text-red-500';
      } else if (strength == 2 || strength == 3) {
        passwordStrengthText.textContent = 'Medio';
        passwordStrengthText.className = 'text-yellow-400';
      } else {
        passwordStrengthText.textContent = 'Fuerte';
        passwordStrengthText.className = 'text-green-500';
      }
    });

    // Registro
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('register-name').value.trim();
      const email = document.getElementById('register-email').value.trim();
      const password = document.getElementById('register-password').value;
      const confirmPassword = document.getElementById('register-confirm-password').value;
      const role = document.getElementById('register-role').value;

      if (!name || !email || !password || !confirmPassword || !role) {
        alert('Por favor, completa todos los campos.');
        return;
      }
      if (password !== confirmPassword) {
        alert('Las contraseñas no coinciden.');
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        // Enviar verificación de email
        await sendEmailVerification(user);
        // Actualizar displayName
        await updateProfile(user, { displayName: name });
        // Guardar datos adicionales en Firestore
        await setDoc(doc(db, 'users', user.uid), {
          name: name,
          email: email,
          role: role,
          userId: user.uid
        });
        alert('Registro exitoso! Revisa tu correo para verificar tu cuenta.');
        registerForm.reset();
      } catch (error) {
        alert('Error en registro: ' + error.message);
      }
    });

    // Login
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        if (!user.emailVerified) {
          alert('Por favor, verifica tu correo antes de iniciar sesión.');
          await sendEmailVerification(user);
          return;
        }
        alert('Inicio de sesión exitoso! Bienvenido ' + user.displayName);
        // Aquí redirigir a la página principal del foro o cargar la interfaz
      } catch (error) {
        alert('Error en inicio de sesión: ' + error.message);
      }
    });

    // Mantener sesión activa (opcional)
    onAuthStateChanged(auth, (user) => {
      if (user && user.emailVerified) {
        // Redirigir si está autenticado y verificado
        // window.location.href = 'foro-main.html';
      }
    });
  </script>

  <style>
    /* Estilo para overlay negro semitransparente */
    .overlay-bg {
      background-color: rgba(0, 0, 0, 0.7);
    }
  </style>
</head>
<body class="bg-byte-dark-bg h-screen overflow-hidden">

  <!-- Video de fondo -->
  <video autoplay loop muted playsinline class="absolute inset-0 w-full h-full object-cover">
    <source src="./images/fondo.mp4" type="video/mp4">
    Tu navegador no soporta la etiqueta de video.
  </video>

  <!-- Contenedor central -->
  <div class="relative z-10 flex items-center justify-center h-full">
    <div class="bg-byte-secondary-dark overlay-bg p-8 rounded-lg max-w-md w-full">

      <!-- Registro -->
      <div id="register-container">
        <h2 class="text-2xl font-bold mb-4 text-byte-accent-cyan font-heading text-center">Regístrate</h2>
        <form id="register-form" class="space-y-4">
          <div>
            <label for="register-name" class="block mb-1 text-byte-text-light">Nombre Completo</label>
            <input type="text" id="register-name" class="w-full p-2 rounded bg-byte-dark-bg text-byte-text-light" required>
          </div>
          <div>
            <label for="register-email" class="block mb-1 text-byte-text-light">Correo Electrónico</label>
            <input type="email" id="register-email" class="w-full p-2 rounded bg-byte-dark-bg text-byte-text-light" required>
          </div>
          <div>
            <label for="register-password" class="block mb-1 text-byte-text-light">Contraseña</label>
            <input type="password" id="register-password" class="w-full p-2 rounded bg-byte-dark-bg text-byte-text-light" required>
            <p id="password-strength-text" class="mt-1 text-sm"></p>
          </div>
          <div>
            <label for="register-confirm-password" class="block mb-1 text-byte-text-light">Confirmar Contraseña</label>
            <input type="password" id="register-confirm-password" class="w-full p-2 rounded bg-byte-dark-bg text-byte-text-light" required>
          </div>
          <div>
            <label for="register-role" class="block mb-1 text-byte-text-light">Selecciona tu Rol</label>
            <select id="register-role" class="w-full p-2 rounded bg-byte-dark-bg text-byte-text-light" required>
              <option value="">-- Selecciona --</option>
              <option value="Instructor">Instructor</option>
              <option value="Aprendiz">Aprendiz</option>
              <option value="Cliente">Cliente</option>
            </select>
          </div>
          <button type="submit" class="w-full bg-byte-accent-cyan text-byte-dark-bg font-bold py-2 rounded hover:bg-cyan-400 transition">Crear Cuenta</button>
        </form>
        <p class="mt-4 text-center text-byte-text-light">¿Ya tienes cuenta? <button id="toggle-to-login" class="text-byte-accent-cyan hover:underline">Inicia Sesión</button></p>
      </div>

      <!-- Login -->
      <div id="login-container" class="hidden">
        <h2 class="text-2xl font-bold mb-4 text-byte-accent-cyan font-heading text-center">Inicia Sesión</h2>
        <form id="login-form" class="space-y-4">
          <div>
            <label for="login-email" class="block mb-1 text-byte-text-light">Correo Electrónico</label>
            <input type="email" id="login-email" class="w-full p-2 rounded bg-byte-dark-bg text-byte-text-light" required>
          </div>
          <div>
            <label for="login-password" class="block mb-1 text-byte-text-light">Contraseña</label>
            <input type="password" id="login-password" class="w-full p-2 rounded bg-byte-dark-bg text-byte-text-light" required>
          </div>
          <button type="submit" class="w-full bg-byte-accent-cyan text-byte-dark-bg font-bold py-2 rounded hover:bg-cyan-400 transition">Entrar</button>
        </form>
        <p class="mt-4 text-center text-byte-text-light">¿No tienes cuenta? <button id="toggle-to-register" class="text-byte-accent-cyan hover:underline">Regístrate</button></p>
      </div>

    </div>
  </div>

</body>
</html>
